<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Azteca Bot</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; display: flex; justify-content: center; align-items: center; height: 100vh; }
      section { display: none; width: 90%; max-width: 500px; background-color: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); overflow: hidden; position: relative; }
      #login-section { padding: 20px; text-align: center; }
      .login-header { color: #ff7300; font-size: 24px; margin-bottom: 20px; }
      .login-input { width: 95%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
      .login-button { width: 100%; padding: 10px; background-color: #ff7300; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
      .login-button:hover { background-color: #ff9100; }
      #chat-section { display: flex; flex-direction: column; height: 80vh; width: 100%; max-width: 500px; background-color: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); overflow: hidden; position: relative; }
      .chat-header { background-color: #ff7300; color: rgb(250, 246, 246); padding: 15px; text-align: center; font-size: 18px; display: flex; justify-content: space-between; align-items: center; position: relative; }
      .menu-button { background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 5px; }
      .menu-dropdown { position: absolute; top: 50px; right: 10px; background-color: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); display: none; z-index: 1; width: 200px; }
      .menu-dropdown.show { display: block; }
      .menu-dropdown button { width: 100%; padding: 12px; background: none; border: none; text-align: left; cursor: pointer; font-size: 16px; }
      .menu-dropdown button:hover { background-color: #f0f0f0; }
      .chat-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: #f9f9f9;
        height: calc(100% - 150px); /* Ajusta seg√∫n el header + input */
        box-sizing: border-box;
        }
      .message { margin-bottom: 10px; padding: 10px 15px; border-radius: 18px; max-width: 80%; word-wrap: break-word; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
      .user-message { background-color: #ff9100; color: white; margin-left: auto; border-bottom-right-radius: 5px; }
      .bot-message { background-color: #e5e5ea; color: black; margin-right: auto; border-bottom-left-radius: 5px; }
      .chat-input { position: absolute; bottom: 0; left: 0; right: 0; display: flex; padding: 10px; background-color: white; border-top: 1px solid #ddd; width: 100%; box-sizing: border-box; height: 60px; }
      #message-input { flex: 1; padding: 10px 15px; border: 2px solid #ff9900; border-radius: 20px; font-size: 16px; outline: none; }
      #send-button { background-color: #ffae00; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; margin-left: 10px; font-size: 18px; cursor: pointer; outline: none; }
      #send-button:active { background-color: #ffbb00; }
      #help-section { padding: 20px; }
      .help-header { color: #ff7300; font-size: 20px; margin-bottom: 20px; text-align: center; }
      .help-question { margin-bottom: 10px; padding: 10px; background-color: #f9f9f9; border-radius: 5px; cursor: pointer; }
      .help-question:hover { background-color: #e5e5ea; }
      .back-button { width: 100%; padding: 10px; background-color: #e5e5ea; color: black; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; margin-top: 20px; }
      #settings-section { padding: 20px; }
      .settings-header { color: #ff7300; font-size: 20px; margin-bottom: 20px; text-align: center; }
      .setting-option { margin-bottom: 15px; }
      .setting-option label { display: block; margin-bottom: 5px; font-weight: bold; }
      .setting-option select, .setting-option input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; }

            /* === MODO OSCURO EN ESCALA DE GRISES === */
      body.dark-theme {
        background-color: #1e1e1e;
        color: #f0f0f0;
        filter: grayscale(100%);
      }

      body.dark-theme section {
        background-color: #2a2a2a;
        color: #e0e0e0;
      }

      body.dark-theme .chat-header {
        background-color: #444;
        color: #f0f0f0;
      }

      body.dark-theme .user-message {
        background-color: #666;
        color: #fff;
      }

      body.dark-theme .bot-message {
        background-color: #888;
        color: #fff;
      }

    </style>
  </head>
  <body>
    <!-- Secci√≥n de Login -->
    <section id="login-section">
      <div class="login-header">Iniciar Sesi√≥n</div>
      <input type="text" class="login-input" placeholder="Usuario" id="username" />
      <input type="password" class="login-input" placeholder="Contrase√±a" id="password" />
      <button class="login-button" id="login-button">Iniciar Sesi√≥n</button>
    </section>

    <!-- Secci√≥n del Chat -->
    <section id="chat-section">
      <div class="chat-header">
        <h2>Azteca Bot</h2>
        <button class="menu-button" id="menu-button">‚ò∞</button>
        <div class="menu-dropdown" id="menu-dropdown">
          <button id="settings-button">Configuraci√≥n</button>
          <button id="help-button">Ayuda</button>
          <button id="clear-chat-button">Vaciar Chat</button>
          <button id="logout-button">Cerrar Sesi√≥n</button>
        </div>
      </div>
      <div class="chat-messages" id="chat-messages">
        <div class="message bot-message">
          ¬°Hola! Soy AztecaBot üëã, tu asistente para la carrera de Negocios Internacionales en la UDLAP.<br>
          Puedo ayudarte con:<br>
          - Materias y plan de estudios üìö<br>
          - Profesores y contactos üßë‚Äçüè´<br>
          - Pr√°cticas profesionales üíº<br>
          - Calendario y eventos üóìÔ∏è<br>
          Ejemplo: ¬øQu√© materias se toman en quinto semestre?
        </div>
      </div>
      <div class="chat-input">
        <input type="text" id="message-input" placeholder="Escribe tu mensaje aqu√≠..." />
        <button id="send-button">‚Üë</button>
      </div>
    </section>

    <!-- Secci√≥n de Ayuda -->
    <section id="help-section">
      <div class="help-header">Ayuda</div>
      <div class="help-question">¬øQu√© materias debo llevar este semestre?</div>
      <div class="help-question">¬øCu√°l es el horario de la materia de Matem√°ticas?</div>
      <div class="help-question">¬øC√≥mo puedo inscribirme a una materia?</div>
      <div class="help-question">¬øD√≥nde puedo ver mis calificaciones?</div>
      <div class="help-question">¬øC√≥mo contacto a mi profesor?</div>
      <button class="back-button" id="back-to-chat-from-help-button">Volver al Chat</button>
    </section>

    <!-- Secci√≥n de Configuraci√≥n -->
    <section id="settings-section">
      <div class="settings-header">Configuraci√≥n</div>
      <div class="setting-option">
        <label for="theme">Tema:</label>
        <select id="theme">
          <option value="light">Claro</option>
          <option value="dark">Oscuro</option>
        </select>
      </div>
      <div class="setting-option">
        <label for="language">Idioma:</label>
        <select id="language">
          <option value="es">Espa√±ol</option>
          <option value="en">Ingl√©s</option>
        </select>
      </div>
      <button class="back-button" id="back-to-chat-button">Volver al Chat</button>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        showSection("login-section");

        // --- LOGIN ---
        document.getElementById("login-button").addEventListener("click", function () {
          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;
          if (username && password) {
            showSection("chat-section");
          } else {
            alert("Por favor, ingresa usuario y contrase√±a.");
          }
        });

        // --- MEN√ö ---
        const menuButton = document.getElementById("menu-button");
        const menuDropdown = document.getElementById("menu-dropdown");
        menuButton.addEventListener("click", function () {
          menuDropdown.classList.toggle("show");
        });

        // --- FUNCIONES GLOBALES ---
        function addMessage(text, isUser) {
          const chatMessages = document.getElementById("chat-messages");
          const messageDiv = document.createElement("div");
          messageDiv.classList.add("message");
          messageDiv.classList.add(isUser ? "user-message" : "bot-message");
          messageDiv.innerHTML = text.replace(/\n/g, "<br>");
          chatMessages.appendChild(messageDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessageToBackend(message) {
          const chatMessages = document.getElementById("chat-messages");

          const lanValue = document.getElementById("language").value;

          // --- Crear mensaje temporal ---
          const tempMessageDiv = document.createElement("div");
          tempMessageDiv.classList.add("message", "bot-message");

          if (lanValue === "es") {
            tempMessageDiv.innerHTML = "‚è≥ Procesando tu pregunta...";
          }
          else {
            tempMessageDiv.innerHTML = "‚è≥ Processing your question...";
          }

          chatMessages.appendChild(tempMessageDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;

          try {
            const res = await fetch("/chat", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ 
                message,
                language: lanValue
              }),
            });
            const data = await res.json();

            // --- Reemplazar mensaje temporal con la respuesta real ---
            tempMessageDiv.innerHTML = data.response.replace(/\n/g, "<br>");
            chatMessages.scrollTop = chatMessages.scrollHeight;
          } catch (error) {

            if (lanValue === "es") {
              tempMessageDiv.innerHTML = "‚ö†Ô∏è Error al conectar con el servidor.";
            }
            else {
              tempMessageDiv.innerHTML = "‚ö†Ô∏è Error connecting to the server.";
            }
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }
        }

        function showSection(sectionId) {
          const sections = document.querySelectorAll("section");
          sections.forEach((section) => { section.style.display = "none"; });
          document.getElementById(sectionId).style.display = "block";
        }

        // --- ENV√çO DE MENSAJES ---
        document.getElementById("send-button").addEventListener("click", function () {
          const messageInput = document.getElementById("message-input");
          const message = messageInput.value.trim();
          if (message) {
            addMessage(message, true);
            messageInput.value = "";
            sendMessageToBackend(message);
          }
        });

        document.getElementById("message-input").addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            const message = this.value.trim();
            if (message) {
              addMessage(message, true);
              this.value = "";
              sendMessageToBackend(message);
            }
          }
        });

        // --- MEN√ö: LIMPIAR CHAT ---
        document.getElementById("clear-chat-button").addEventListener("click", function () {
          document.getElementById("chat-messages").innerHTML = "";
          
          const lanValue = document.getElementById("language").value;

          if (lanValue === "es") {
            addMessage(
            "¬°Hola! Soy AztecaBot üëã, tu asistente para la carrera de Negocios Internacionales en la UDLAP.<br>" +
            "Puedo ayudarte con:<br>" +
            "- Materias y plan de estudios üìö<br>" +
            "- Profesores y contactos üßë‚Äçüè´<br>" +
            "- Pr√°cticas profesionales üíº<br>" +
            "- Calendario y eventos üóìÔ∏è<br>" +
            "Ejemplo: ¬øQu√© materias se toman en quinto semestre?",
            false);
          }
          else {
            addMessage(
            "Hi! I'm AztecaBot üëã, your assistant for the International Business program at UDLAP.<br>" + 
            "I can help you with:<br>" + 
            "- Courses and curriculum üìö<br>" + 
            "- Professors and contacts üßë‚Äçüè´<br>" + 
            "- Internships üíº<br>" +
            "- Calendar and events üóìÔ∏è<br>" + 
            "Example: What subjects are taken in the fifth semester?",
            false);
          }
          menuDropdown.classList.remove("show");
        });

        // --- MEN√ö: CONFIGURACI√ìN / AYUDA / LOGOUT ---
        document.getElementById("settings-button").addEventListener("click", function () {
          showSection("settings-section");
          menuDropdown.classList.remove("show");
        });

        document.getElementById("help-button").addEventListener("click", function () {
          showSection("help-section");
          menuDropdown.classList.remove("show");
        });

        document.getElementById("logout-button").addEventListener("click", function () {
          showSection("login-section");
          menuDropdown.classList.remove("show");
        });

        document.getElementById("back-to-chat-from-help-button").addEventListener("click", function () {
          showSection("chat-section");
        });

        document.getElementById("back-to-chat-button").addEventListener("click", function () {
          showSection("chat-section");
        });

        const helpQuestions = document.querySelectorAll(".help-question");
        helpQuestions.forEach(question => {
          question.addEventListener("click", () => {
            const text = question.textContent.trim();
            addMessage(text, true);     
            sendMessageToBackend(text);    
            showSection("chat-section");   
          });
        });

                // --- CAMBIO DE TEMA ---
        document.getElementById("theme").addEventListener("change", function () {
          const theme = this.value;
          if (theme === "dark") {
            document.body.classList.add("dark-theme");
          } else {
            document.body.classList.remove("dark-theme");
          }
        });

                // --- CAMBIO DE IDIOMA ---
        const translations = {
          es: {
            loginTitle: "Iniciar Sesi√≥n",
            username: "Usuario",
            password: "Contrase√±a",
            loginButton: "Iniciar Sesi√≥n",
            botIntro: "¬°Hola! Soy AztecaBot üëã, tu asistente para la carrera de Negocios Internacionales en la UDLAP.<br>Puedo ayudarte con:<br>- Materias y plan de estudios üìö<br>- Profesores y contactos üßë‚Äçüè´<br>- Pr√°cticas profesionales üíº<br>- Calendario y eventos üóìÔ∏è<br>Ejemplo: ¬øQu√© materias se toman en quinto semestre?",
            helpTitle: "Ayuda",
            settingsTitle: "Configuraci√≥n",
            backButton: "Volver al Chat",
            inputMessage: "Escribe tu mensaje aqu√≠...",
            menuSettings: "Configuraci√≥n",
            settingsTheme: "Tema",
            themeLight: "Claro",
            themeDark: "Oscuro",
            settingsLan: "Idioma",
            lanSpa: "Espa√±ol",
            lanEng: "Ingl√©s",
            menuHelp: "Ayuda",
            helpQ1: "¬øQu√© materias debo llevar este semestre?",
            helpQ2: "¬øCu√°l es el horario de la materia de Matem√°ticas?",
            helpQ3: "¬øC√≥mo puedo inscribirme a una materia?",
            helpQ4: "¬øD√≥nde puedo ver mis calificaciones?",
            helpQ5: "¬øC√≥mo contacto a mi profesor?",
            menuClear: "Vaciar Chat",
            menuLogout: "Cerrar Sesi√≥n",
          },
          en: {
            loginTitle: "Log In",
            username: "Username",
            password: "Password",
            loginButton: "Log In",
            botIntro: "Hi! I'm AztecaBot üëã, your assistant for the International Business program at UDLAP.<br>I can help you with:<br>- Courses and curriculum üìö<br>- Professors and contacts üßë‚Äçüè´<br>- Internships üíº<br>- Calendar and events üóìÔ∏è<br>Example: What subjects are taken in the fifth semester?",
            helpTitle: "Help",
            settingsTitle: "Settings",
            backButton: "Back to Chat",
            inputMessage: "Write your message here...",
            menuSettings: "Settings",
            settingsTheme: "Theme",
            themeLight: "Light",
            themeDark: "Dark",
            settingsLan: "Language",
            lanSpa: "Spanish",
            lanEng: "English",
            menuHelp: "Help",
            helpQ1: "What courses should I take this semester?",
            helpQ2: "What is the schedule for the Mathematics course?",
            helpQ3: "How can I enroll in a course?",
            helpQ4: "Where can I check my grades?",
            helpQ5: "How do I contact my professor?",
            menuClear: "Clear Chat",
            menuLogout: "Log Out",
          }
        };

        document.getElementById("language").addEventListener("change", function () {
          const lang = this.value;
          const t = translations[lang];
          document.querySelector(".login-header").textContent = t.loginTitle;
          document.getElementById("username").placeholder = t.username;
          document.getElementById("password").placeholder = t.password;
          document.getElementById("login-button").textContent = t.loginButton;
          document.querySelector(".help-header").textContent = t.helpTitle;
          document.querySelector(".settings-header").textContent = t.settingsTitle;
          document.getElementById("back-to-chat-button").textContent = t.backButton;
          document.getElementById("back-to-chat-from-help-button").textContent = t.backButton;
          document.getElementById("message-input").placeholder = t.inputMessage;
          document.getElementById("settings-button").textContent = t.menuSettings;
          document.querySelector('label[for = "theme"]').textContent = t.settingsTheme;
          document.querySelector('#theme option[value = "light"]').textContent = t.themeLight;
          document.querySelector('#theme option[value = "dark"]').textContent = t.themeDark;
          document.querySelector('label[for = "language"]').textContent = t.settingsLan;
          document.querySelector('#language option[value = "es"]').textContent = t.lanSpa;
          document.querySelector('#language option[value = "en"]').textContent = t.lanEng;
          document.getElementById("help-button").textContent = t.menuHelp;
          document.querySelectorAll('.help-question')[0].textContent = t.helpQ1;
          document.querySelectorAll('.help-question')[1].textContent = t.helpQ2;
          document.querySelectorAll('.help-question')[2].textContent = t.helpQ3;
          document.querySelectorAll('.help-question')[3].textContent = t.helpQ4;
          document.querySelectorAll('.help-question')[4].textContent = t.helpQ5;
          document.getElementById("clear-chat-button").textContent = t.menuClear;
          document.getElementById("logout-button").textContent = t.menuLogout;
          const firstBotMessage = document.querySelector("#chat-messages .bot-message:first-child");
          if (firstBotMessage) firstBotMessage.innerHTML = t.botIntro;
        });
      });
    </script>
  </body>
</html>
